{"version":3,"sources":["../../src/commands/push-creds.ts"],"names":["program","command","description","helpGroup","option","asyncActionProjectDir","projectDir","options","apiKey","length","Error","ctx","Context","init","experienceName","projectOwner","manifest","slug","android","updateFcmKey","fcmCredentials","fetchFcmKey","fcmApiKey","CommandError","removeFcmKey"],"mappings":";;;;;;;AAEA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;;;AAEe,kBAAUA,OAAV,EAA4B;AACzCA,EAAAA,OAAO,CACJC,OADH,CACW,4BADX,EAEGC,WAFH,CAEe,kDAFf,EAGGC,SAHH,CAGa,eAHb,EAIGC,MAJH,CAIU,qBAJV,EAIiC,yBAJjC,EAKGC,qBALH,CAKyB,OAAOC,UAAP,EAA2BC,OAA3B,KAA4D;AACjF,QAAI,CAACA,OAAO,CAACC,MAAT,IAAmBD,OAAO,CAACC,MAAR,CAAeC,MAAf,KAA0B,CAAjD,EAAoD;AAClD,YAAM,IAAIC,KAAJ,CAAU,mDAAV,CAAN;AACD;;AAED,UAAMC,GAAG,GAAG,KAAIC,kBAAJ,GAAZ;AACA,UAAMD,GAAG,CAACE,IAAJ,CAASP,UAAT,CAAN;AACA,UAAMQ,cAAc,GAAI,IAAGH,GAAG,CAACI,YAAa,IAAGJ,GAAG,CAACK,QAAJ,CAAaC,IAAK,EAAjE;AAEA,UAAMN,GAAG,CAACO,OAAJ,CAAYC,YAAZ,CAAyBL,cAAzB,EAAyCP,OAAO,CAACC,MAAjD,CAAN;AACA,wBAAI,WAAJ;AACD,GAhBH;AAkBAR,EAAAA,OAAO,CACJC,OADH,CACW,0BADX,EAEGC,WAFH,CAEe,uEAFf,EAGGC,SAHH,CAGa,eAHb,EAIGE,qBAJH,CAIyB,MAAOC,UAAP,IAA8B;AACnD,UAAMK,GAAG,GAAG,KAAIC,kBAAJ,GAAZ;AACA,UAAMD,GAAG,CAACE,IAAJ,CAASP,UAAT,CAAN;AACA,UAAMQ,cAAc,GAAI,IAAGH,GAAG,CAACI,YAAa,IAAGJ,GAAG,CAACK,QAAJ,CAAaC,IAAK,EAAjE;AAEA,UAAMG,cAAc,GAAG,MAAMT,GAAG,CAACO,OAAJ,CAAYG,WAAZ,CAAwBP,cAAxB,CAA7B;;AACA,QAAIM,cAAJ,aAAIA,cAAJ,uBAAIA,cAAc,CAAEE,SAApB,EAA+B;AAC7B,0BAAK,gBAAeF,cAAhB,aAAgBA,cAAhB,uBAAgBA,cAAc,CAAEE,SAAU,EAA9C;AACD,KAFD,MAEO;AACL,YAAM,KAAIC,uBAAJ,EAAkB,qDAAlB,CAAN;AACD;AACF,GAfH;AAiBAvB,EAAAA,OAAO,CACJC,OADH,CACW,2BADX,EAEGC,WAFH,CAEe,6CAFf,EAGGC,SAHH,CAGa,eAHb,EAIGE,qBAJH,CAIyB,MAAOC,UAAP,IAA8B;AACnD,UAAMK,GAAG,GAAG,KAAIC,kBAAJ,GAAZ;AACA,UAAMD,GAAG,CAACE,IAAJ,CAASP,UAAT,CAAN;AACA,UAAMQ,cAAc,GAAI,IAAGH,GAAG,CAACI,YAAa,IAAGJ,GAAG,CAACK,QAAJ,CAAaC,IAAK,EAAjE;AAEA,UAAMN,GAAG,CAACO,OAAJ,CAAYM,YAAZ,CAAyBV,cAAzB,CAAN;AACA,wBAAI,WAAJ;AACD,GAXH;AAYD","sourcesContent":["import { Command } from 'commander';\n\nimport CommandError from '../CommandError';\nimport { Context } from '../credentials/context';\nimport log from '../log';\n\nexport default function (program: Command) {\n  program\n    .command('push:android:upload [path]')\n    .description('Upload an FCM key for Android push notifications')\n    .helpGroup('notifications')\n    .option('--api-key [api-key]', 'Server API key for FCM.')\n    .asyncActionProjectDir(async (projectDir: string, options: { apiKey?: string }) => {\n      if (!options.apiKey || options.apiKey.length === 0) {\n        throw new Error('Must specify an API key to upload with --api-key.');\n      }\n\n      const ctx = new Context();\n      await ctx.init(projectDir);\n      const experienceName = `@${ctx.projectOwner}/${ctx.manifest.slug}`;\n\n      await ctx.android.updateFcmKey(experienceName, options.apiKey);\n      log('All done!');\n    });\n\n  program\n    .command('push:android:show [path]')\n    .description('Log the value currently in use for FCM notifications for this project')\n    .helpGroup('notifications')\n    .asyncActionProjectDir(async (projectDir: string) => {\n      const ctx = new Context();\n      await ctx.init(projectDir);\n      const experienceName = `@${ctx.projectOwner}/${ctx.manifest.slug}`;\n\n      const fcmCredentials = await ctx.android.fetchFcmKey(experienceName);\n      if (fcmCredentials?.fcmApiKey) {\n        log(`FCM API key: ${fcmCredentials?.fcmApiKey}`);\n      } else {\n        throw new CommandError(`There is no FCM API key configured for this project`);\n      }\n    });\n\n  program\n    .command('push:android:clear [path]')\n    .description('Delete a previously uploaded FCM credential')\n    .helpGroup('notifications')\n    .asyncActionProjectDir(async (projectDir: string) => {\n      const ctx = new Context();\n      await ctx.init(projectDir);\n      const experienceName = `@${ctx.projectOwner}/${ctx.manifest.slug}`;\n\n      await ctx.android.removeFcmKey(experienceName);\n      log('All done!');\n    });\n}\n"],"file":"push-creds.js"}