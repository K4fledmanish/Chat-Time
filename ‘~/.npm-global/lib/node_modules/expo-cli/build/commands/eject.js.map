{"version":3,"sources":["../../src/commands/eject.ts"],"names":["userWantsToEjectWithoutUpgradingAsync","answer","message","getDefaultPlatforms","platforms","process","platform","push","platformsFromPlatform","log","warn","CommandError","actionAsync","projectDir","options","exp","npm","packageManager","Versions","lteSdkVersion","force","debug","LegacyEject","ejectAsync","Eject","program","command","description","chalk","dim","longDescription","helpGroup","option","asyncActionProjectDir"],"mappings":"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","sourcesContent":["import { getConfig } from '@expo/config';\nimport { ModPlatform } from '@expo/config-plugins';\nimport { Versions } from '@expo/xdl';\nimport chalk from 'chalk';\nimport { Command } from 'commander';\n\nimport CommandError from '../CommandError';\nimport log from '../log';\nimport { confirmAsync } from '../prompts';\nimport * as Eject from './eject/Eject';\nimport * as LegacyEject from './eject/LegacyEject';\nimport { learnMore } from './utils/TerminalLink';\n\nasync function userWantsToEjectWithoutUpgradingAsync() {\n  const answer = await confirmAsync({\n    message: `We recommend upgrading to the latest SDK version before ejecting. SDK 37 introduces support for OTA updates and notifications in ejected projects, and includes many features that make ejecting your project easier. Would you like to continue ejecting anyways?`,\n  });\n\n  return answer;\n}\n\nfunction getDefaultPlatforms(): ModPlatform[] {\n  const platforms: ModPlatform[] = ['android'];\n  if (process.platform !== 'win32') {\n    platforms.push('ios');\n  }\n  return platforms;\n}\n\nfunction platformsFromPlatform(platform?: string): ModPlatform[] {\n  if (!platform) {\n    return getDefaultPlatforms();\n  }\n  switch (platform) {\n    case 'ios':\n      if (process.platform === 'win32') {\n        log.warn('Ejecting on windows is unsupported');\n        // continue anyways :shrug:\n      }\n      return ['ios'];\n    case 'android':\n      return ['android'];\n    case 'all':\n      return getDefaultPlatforms();\n    default:\n      throw new CommandError(`Unsupported platform \"${platform}\". Options are: ios, android, all`);\n  }\n}\n\nexport async function actionAsync(\n  projectDir: string,\n  {\n    platform,\n    ...options\n  }: (LegacyEject.EjectAsyncOptions | Eject.EjectAsyncOptions) & {\n    npm?: boolean;\n    platform?: string;\n  }\n) {\n  const { exp } = getConfig(projectDir);\n\n  if (options.npm) {\n    options.packageManager = 'npm';\n  }\n\n  // Set EXPO_VIEW_DIR to universe/exponent to pull expo view code locally instead of from S3 for ExpoKit\n  // TODO: remove LegacyEject when SDK 36 is no longer supported: after SDK 40 is released.\n  if (Versions.lteSdkVersion(exp, '36.0.0')) {\n    if (options.force || (await userWantsToEjectWithoutUpgradingAsync())) {\n      log.debug('Eject Mode: Legacy');\n      await LegacyEject.ejectAsync(projectDir, options as LegacyEject.EjectAsyncOptions);\n    }\n  } else {\n    log.debug('Eject Mode: Latest');\n    await Eject.ejectAsync(projectDir, {\n      ...options,\n      platforms: platformsFromPlatform(platform),\n    } as Eject.EjectAsyncOptions);\n  }\n}\n\nexport default function (program: Command) {\n  program\n    .command('eject [path]')\n    .description(\n      `Create native iOS and Android project files. ${chalk.dim(\n        learnMore('https://docs.expo.io/bare/customizing/')\n      )}`\n    )\n    .longDescription(\n      'Create Xcode and Android Studio projects for your app. Use this if you need to add custom native functionality.'\n    )\n    .helpGroup('eject')\n    .option('--force', 'Skip legacy eject warnings.') // TODO: remove the force flag when SDK 36 is no longer supported: after SDK 40 is released.\n    .option('--no-install', 'Skip installing npm packages and CocoaPods.')\n    .option('--npm', 'Use npm to install dependencies. (default when Yarn is not installed)')\n    .option('-p, --platform [platform]', 'Platforms to sync: ios, android, all. Default: all')\n    .asyncActionProjectDir(actionAsync);\n}\n"],"file":"eject.js"}