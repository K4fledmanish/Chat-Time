{"version":3,"sources":["../../../src/commands/eject/Eject.ts"],"names":["ejectAsync","projectRoot","platforms","options","length","CommandError","isWindows","process","platform","includes","log","warn","chalk","bold","newLine","exp","pkg","ensureConfigAsync","tempDir","temporary","directory","hasNewProjectFiles","needsPodInstall","createNativeProjectsFromTemplateAsync","isSyncing","shouldInstall","install","packageManager","CreateApp","resolvePackageManager","npm","yarn","installNodeDependenciesAsync","clean","configureIOSStepAsync","configureAndroidStepAsync","podsInstalled","installCocoaPodsAsync","debug","warnIfDependenciesRequireAdditionalSetupAsync","sdkVersion","nested","WarningAggregator","hasWarningsIOS","hasWarningsAndroid","installCmd","hasOwnProperty","dim","fallback","text","props","applyingIOSConfigStep","logNewSection","stopAndPersist","symbol","red","succeed","cleanJsDepsStep","fs","remove","installJsDepsStep","message","fail","SilentError","applyingAndroidConfigStep","copyPathsFromTemplate","templatePath","paths","copiedPaths","skippedPaths","targetPath","projectPath","path","join","existsSync","push","copySync","config","dynamicConfigPath","staticConfigPath","JsonFile","writeAsync","expo","json5","error","addNewLineIfNone","entryPoint","createFileHash","contents","crypto","createHash","update","digest","writeMetroConfig","updatingMetroConfigStep","sourceConfigPath","targetConfigPath","targetConfigPathExists","readFileSync","targetContents","Error","stop","clear","metro","e","validateBareTemplateExistsAsync","sdkMajorVersionNumber","semver","major","templateSpec","pacote","manifest","code","updatePackageJSONAsync","defaultDependencies","defaultDevDependencies","dependencies","devDependencies","read","createDependenciesMap","updatingPackageJsonStep","scripts","start","ios","android","combinedDependencies","requiredDependencies","dependenciesKey","combinedDevDependencies","hasNewDependencies","hashForDependencyMap","hasNewDevDependencies","removedPkgMain","shouldDeleteMainField","main","writeFile","resolve","JSON","stringify","resolveBareEntryFile","isPkgMainExpoAppEntry","resolvedMainField","extensions","startsWith","normalizeDependencyMap","deps","Object","keys","map","dependency","sort","depsList","depsString","getTargetPaths","targetPaths","bareEntryFile","cloneNativeDirectoriesAsync","creatingNativeProjectStep","Exp","extractTemplateAppAsync","results","GitIgnore","mergeGitIgnorePaths","didMerge","didClear","yellow","depsResults","outputMap","key","value","expoPackagesWithExtraSetup","reduce","prev","curr","pkgsWithExtraSetup","lte","packagesToWarn","filter","pkgName","warnAdditionalSetupStep","plural","forEach","stripDashes","s","replace","input"],"mappings":"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","sourcesContent":["import { ExpoConfig, getConfig, PackageJSONConfig } from '@expo/config';\nimport { ModPlatform, WarningAggregator } from '@expo/config-plugins';\nimport { getBareExtensions, getFileWithExtensions } from '@expo/config/paths';\nimport JsonFile, { JSONObject } from '@expo/json-file';\nimport { Exp } from '@expo/xdl';\nimport chalk from 'chalk';\nimport crypto from 'crypto';\nimport fs from 'fs-extra';\nimport npmPackageArg from 'npm-package-arg';\nimport pacote from 'pacote';\nimport path from 'path';\nimport semver from 'semver';\nimport temporary from 'tempy';\nimport terminalLink from 'terminal-link';\n\nimport CommandError, { SilentError } from '../../CommandError';\nimport log from '../../log';\nimport configureAndroidProjectAsync from '../apply/configureAndroidProjectAsync';\nimport configureIOSProjectAsync from '../apply/configureIOSProjectAsync';\nimport * as CreateApp from '../utils/CreateApp';\nimport * as GitIgnore from '../utils/GitIgnore';\nimport { usesOldExpoUpdatesAsync } from '../utils/ProjectUtils';\nimport { learnMore } from '../utils/TerminalLink';\nimport { logConfigWarningsAndroid, logConfigWarningsIOS } from '../utils/logConfigWarnings';\nimport maybeBailOnGitStatusAsync from '../utils/maybeBailOnGitStatusAsync';\nimport { getOrPromptForBundleIdentifier, getOrPromptForPackage } from './ConfigValidation';\n\ntype DependenciesMap = { [key: string]: string | number };\n\nexport type EjectAsyncOptions = {\n  verbose?: boolean;\n  force?: boolean;\n  install?: boolean;\n  packageManager?: 'npm' | 'yarn';\n  platforms: ModPlatform[];\n};\n\n/**\n * Entry point into the eject process, delegates to other helpers to perform various steps.\n *\n * 1. Verify git is clean\n * 2. Create native projects (ios, android)\n * 3. Install node modules\n * 4. Apply config to native projects\n * 5. Install CocoaPods\n * 6. Log project info\n */\nexport async function ejectAsync(\n  projectRoot: string,\n  { platforms, ...options }: EjectAsyncOptions\n): Promise<void> {\n  if (!platforms?.length) {\n    throw new CommandError('At least one platform must be enabled when syncing');\n  }\n\n  const isWindows = process.platform === 'win32';\n  // Skip ejecting for iOS on Windows\n  if (isWindows && !platforms.includes('ios')) {\n    log.warn(\n      `⚠️  Skipping generating the iOS native project files. Run ${chalk.bold(\n        'expo eject'\n      )} again from macOS or Linux to generate the iOS project.`\n    );\n    log.newLine();\n  }\n\n  if (await maybeBailOnGitStatusAsync()) return;\n\n  const { exp, pkg } = await ensureConfigAsync({ projectRoot, platforms });\n  const tempDir = temporary.directory();\n\n  const { hasNewProjectFiles, needsPodInstall } = await createNativeProjectsFromTemplateAsync({\n    projectRoot,\n    exp,\n    pkg,\n    tempDir,\n    platforms,\n  });\n  // Set this to true when we can detect that the user is running eject to sync new changes rather than ejecting to bare.\n  // This will be used to prevent the node modules from being nuked every time.\n  const isSyncing = !hasNewProjectFiles;\n\n  // Install node modules\n  const shouldInstall = options?.install !== false;\n\n  const packageManager = CreateApp.resolvePackageManager({\n    install: shouldInstall,\n    npm: options?.packageManager === 'npm',\n    yarn: options?.packageManager === 'yarn',\n  });\n\n  if (shouldInstall) {\n    await installNodeDependenciesAsync(projectRoot, packageManager, { clean: !isSyncing });\n  }\n\n  // Apply Expo config to native projects\n  if (platforms.includes('ios')) {\n    await configureIOSStepAsync({ projectRoot, platforms });\n  }\n\n  if (platforms.includes('android')) {\n    await configureAndroidStepAsync({ projectRoot, platforms });\n  }\n\n  // Install CocoaPods\n  let podsInstalled: boolean = false;\n  // err towards running pod install less because it's slow and users can easily run npx pod-install afterwards.\n  if (platforms.includes('ios') && shouldInstall && needsPodInstall) {\n    podsInstalled = await CreateApp.installCocoaPodsAsync(projectRoot);\n  } else {\n    log.debug('Skipped pod install');\n  }\n\n  await warnIfDependenciesRequireAdditionalSetupAsync(pkg, exp.sdkVersion);\n\n  log.newLine();\n  log.nested(`➡️  ${chalk.bold('Next steps')}`);\n\n  if (WarningAggregator.hasWarningsIOS() || WarningAggregator.hasWarningsAndroid()) {\n    log.nested(\n      `- 👆 Review the logs above and look for any warnings (⚠️ ) that might need follow-up.`\n    );\n  }\n\n  // Log a warning about needing to install node modules\n  if (options?.install === false) {\n    const installCmd = packageManager === 'npm' ? 'npm install' : 'yarn';\n    log.nested(`- ⚠️  Install node modules: ${log.chalk.bold(installCmd)}`);\n  }\n  if (!podsInstalled) {\n    log.nested(\n      `- 🍫 When CocoaPods is installed, initialize the project workspace: ${chalk.bold(\n        'npx pod-install'\n      )}`\n    );\n  }\n  log.nested(\n    `- 💡 You may want to run ${chalk.bold(\n      'npx @react-native-community/cli doctor'\n    )} to help install any tools that your app may need to run your native projects.`\n  );\n  log.nested(\n    `- 🔑 Download your Android keystore (if you're not sure if you need to, just run the command and see): ${chalk.bold(\n      'expo fetch:android:keystore'\n    )}`\n  );\n\n  if (exp.hasOwnProperty('assetBundlePatterns')) {\n    log.nested(\n      `- 📁 The property ${chalk.bold(\n        `assetBundlePatterns`\n      )} does not have the same effect in the bare workflow. ${log.chalk.dim(\n        learnMore('https://docs.expo.io/bare/updating-your-app/#embedding-assets')\n      )}`\n    );\n  }\n\n  if (await usesOldExpoUpdatesAsync(projectRoot)) {\n    log.nested(\n      `- 🚀 ${\n        (terminalLink(\n          'expo-updates',\n          'https://github.com/expo/expo/blob/master/packages/expo-updates/README.md'\n        ),\n        {\n          fallback: (text: string) => text,\n        })\n      } has been configured in your project. Before you do a release build, make sure you run ${chalk.bold(\n        'expo publish'\n      )}. ${log.chalk.dim(learnMore('https://expo.fyi/release-builds-with-expo-updates'))}`\n    );\n  }\n\n  if (hasNewProjectFiles) {\n    log.newLine();\n    log.nested(`☑️  ${chalk.bold('When you are ready to run your project')}`);\n    log.nested(\n      'To compile and run your project in development, execute one of the following commands:'\n    );\n\n    if (platforms.includes('ios')) {\n      log.nested(`- ${chalk.bold(packageManager === 'npm' ? 'npm run ios' : 'yarn ios')}`);\n    }\n\n    if (platforms.includes('android')) {\n      log.nested(`- ${chalk.bold(packageManager === 'npm' ? 'npm run android' : 'yarn android')}`);\n    }\n\n    log.nested(`- ${chalk.bold(packageManager === 'npm' ? 'npm run web' : 'yarn web')}`);\n  }\n}\n\nasync function configureIOSStepAsync(props: { projectRoot: string; platforms: ModPlatform[] }) {\n  const applyingIOSConfigStep = CreateApp.logNewSection('iOS config syncing');\n  await configureIOSProjectAsync(props);\n  if (WarningAggregator.hasWarningsIOS()) {\n    applyingIOSConfigStep.stopAndPersist({\n      symbol: '⚠️ ',\n      text: chalk.red('iOS config synced with warnings that should be fixed:'),\n    });\n    logConfigWarningsIOS();\n  } else {\n    applyingIOSConfigStep.succeed('iOS config synced');\n  }\n}\n\n/**\n * Wraps PackageManager to install node modules and adds CLI logs.\n *\n * @param projectRoot\n */\nasync function installNodeDependenciesAsync(\n  projectRoot: string,\n  packageManager: 'yarn' | 'npm',\n  { clean = true }: { clean: boolean }\n) {\n  if (clean) {\n    // This step can take a couple seconds, if the installation logs are enabled (with EXPO_DEBUG) then it\n    // ends up looking odd to see \"Installing JavaScript dependencies\" for ~5 seconds before the logs start showing up.\n    const cleanJsDepsStep = CreateApp.logNewSection('Cleaning JavaScript dependencies.');\n    // nuke the node modules\n    // TODO: this is substantially slower, we should find a better alternative to ensuring the modules are installed.\n    await fs.remove('node_modules');\n    cleanJsDepsStep.succeed('Cleaned JavaScript dependencies.');\n  }\n\n  const installJsDepsStep = CreateApp.logNewSection('Installing JavaScript dependencies.');\n\n  try {\n    await CreateApp.installNodeDependenciesAsync(projectRoot, packageManager);\n    installJsDepsStep.succeed('Installed JavaScript dependencies.');\n  } catch {\n    const message = `Something went wrong installing JavaScript dependencies, check your ${packageManager} logfile or run ${chalk.bold(\n      `${packageManager} install`\n    )} again manually.`;\n    installJsDepsStep.fail(chalk.red(message));\n    // TODO: actually show the error message from the package manager! :O\n    throw new SilentError(message);\n  }\n}\n\nasync function configureAndroidStepAsync(props: { projectRoot: string; platforms: ModPlatform[] }) {\n  const applyingAndroidConfigStep = CreateApp.logNewSection('Android config syncing');\n  await configureAndroidProjectAsync(props);\n  if (WarningAggregator.hasWarningsAndroid()) {\n    applyingAndroidConfigStep.stopAndPersist({\n      symbol: '⚠️ ',\n      text: chalk.red('Android config synced with warnings that should be fixed:'),\n    });\n    logConfigWarningsAndroid();\n  } else {\n    applyingAndroidConfigStep.succeed('Android config synced');\n  }\n}\n\nfunction copyPathsFromTemplate(\n  projectRoot: string,\n  templatePath: string,\n  paths: string[]\n): [string[], string[]] {\n  const copiedPaths = [];\n  const skippedPaths = [];\n  for (const targetPath of paths) {\n    const projectPath = path.join(projectRoot, targetPath);\n    if (!fs.existsSync(projectPath)) {\n      copiedPaths.push(targetPath);\n      fs.copySync(path.join(templatePath, targetPath), projectPath);\n    } else {\n      skippedPaths.push(targetPath);\n    }\n  }\n  return [copiedPaths, skippedPaths];\n}\n\nasync function ensureConfigAsync({\n  projectRoot,\n  platforms,\n}: {\n  projectRoot: string;\n  platforms: ModPlatform[];\n}): Promise<{ exp: ExpoConfig; pkg: PackageJSONConfig }> {\n  // We need the SDK version to proceed\n\n  let exp: ExpoConfig;\n  let pkg: PackageJSONConfig;\n  try {\n    const config = getConfig(projectRoot);\n    exp = config.exp;\n    pkg = config.pkg;\n\n    // If no config exists in the file system then we should generate one so the process doesn't fail.\n    if (!config.dynamicConfigPath && !config.staticConfigPath) {\n      // Don't check for a custom config path because the process should fail if a custom file doesn't exist.\n      // Write the generated config.\n      // writeConfigJsonAsync(projectRoot, config.exp);\n      await JsonFile.writeAsync(\n        // TODO: Write to app.config.json because it's easier to convert to a js config file.\n        path.join(projectRoot, 'app.json'),\n        { expo: (config.exp as unknown) as JSONObject },\n        { json5: false }\n      );\n    }\n  } catch (error) {\n    // TODO(Bacon): Currently this is already handled in the command\n    log.addNewLineIfNone();\n    throw new CommandError(`${error.message}\\n`);\n  }\n\n  // Prompt for the Android package first because it's more strict than the bundle identifier\n  // this means you'll have a better chance at matching the bundle identifier with the package name.\n  if (platforms.includes('android')) {\n    await getOrPromptForPackage(projectRoot);\n  }\n  if (platforms.includes('ios')) {\n    await getOrPromptForBundleIdentifier(projectRoot);\n  }\n\n  if (exp.entryPoint) {\n    delete exp.entryPoint;\n    log(`- expo.entryPoint is not needed and has been removed.`);\n  }\n\n  // Read config again because prompting for bundle id or package name may have mutated the results.\n  return getConfig(projectRoot);\n}\n\nfunction createFileHash(contents: string): string {\n  // this doesn't need to be secure, the shorter the better.\n  return crypto.createHash('sha1').update(contents).digest('hex');\n}\n\nfunction writeMetroConfig({\n  projectRoot,\n  pkg,\n  tempDir,\n}: {\n  projectRoot: string;\n  pkg: PackageJSONConfig;\n  tempDir: string;\n}) {\n  /**\n   * Add metro config, or warn if metro config already exists. The developer will need to add the\n   * hashAssetFiles plugin manually.\n   */\n\n  const updatingMetroConfigStep = CreateApp.logNewSection('Adding Metro bundler configuration');\n\n  try {\n    const sourceConfigPath = path.join(tempDir, 'metro.config.js');\n    const targetConfigPath = path.join(projectRoot, 'metro.config.js');\n    const targetConfigPathExists = fs.existsSync(targetConfigPath);\n    if (targetConfigPathExists) {\n      // Prevent re-runs from throwing an error if the metro config hasn't been modified.\n      const contents = createFileHash(fs.readFileSync(targetConfigPath, 'utf8'));\n      const targetContents = createFileHash(fs.readFileSync(sourceConfigPath, 'utf8'));\n      if (contents !== targetContents) {\n        throw new Error('Existing Metro configuration found; not overwriting.');\n      } else {\n        // Nothing to change, hide the step and exit.\n        updatingMetroConfigStep.stop();\n        updatingMetroConfigStep.clear();\n        return;\n      }\n    } else if (\n      fs.existsSync(path.join(projectRoot, 'metro.config.json')) ||\n      pkg.metro ||\n      fs.existsSync(path.join(projectRoot, 'rn-cli.config.js'))\n    ) {\n      throw new Error('Existing Metro configuration found; not overwriting.');\n    }\n\n    fs.copySync(sourceConfigPath, targetConfigPath);\n    updatingMetroConfigStep.succeed('Added Metro bundler configuration.');\n  } catch (e) {\n    updatingMetroConfigStep.stopAndPersist({\n      symbol: '⚠️ ',\n      text: chalk.red('Metro bundler configuration not applied:'),\n    });\n    log.nested(`- ${e.message}`);\n    log.nested(\n      `- You will need to add the ${chalk.bold(\n        'hashAssetFiles'\n      )} plugin to your Metro configuration. ${log.chalk.dim(\n        learnMore('https://docs.expo.io/bare/installing-updates/')\n      )}`\n    );\n    log.newLine();\n  }\n}\n\nasync function validateBareTemplateExistsAsync(sdkVersion: string): Promise<npmPackageArg.Result> {\n  // Validate that the template exists\n  const sdkMajorVersionNumber = semver.major(sdkVersion);\n  const templateSpec = npmPackageArg(`expo-template-bare-minimum@sdk-${sdkMajorVersionNumber}`);\n  try {\n    await pacote.manifest(templateSpec);\n  } catch (e) {\n    if (e.code === 'E404') {\n      throw new Error(\n        `Unable to eject because an eject template for SDK ${sdkMajorVersionNumber} was not found.`\n      );\n    } else {\n      throw e;\n    }\n  }\n\n  return templateSpec;\n}\n\ntype DependenciesModificationResults = {\n  hasNewDependencies: boolean;\n  hasNewDevDependencies: boolean;\n};\n\nasync function updatePackageJSONAsync({\n  projectRoot,\n  tempDir,\n  pkg,\n}: {\n  projectRoot: string;\n  tempDir: string;\n  pkg: PackageJSONConfig;\n}): Promise<DependenciesModificationResults> {\n  let defaultDependencies: any = {};\n  let defaultDevDependencies: any = {};\n  const { dependencies, devDependencies } = JsonFile.read(path.join(tempDir, 'package.json'));\n  defaultDependencies = createDependenciesMap(dependencies);\n  defaultDevDependencies = createDependenciesMap(devDependencies);\n  /**\n   * Update package.json scripts - `npm start` should default to `react-native\n   * start` rather than `expo start` after ejecting, for example.\n   */\n  // NOTE(brentvatne): Removing spaces between steps for now, add back when\n  // there is some additional context for steps\n  const updatingPackageJsonStep = CreateApp.logNewSection(\n    'Updating your package.json scripts, dependencies, and main file'\n  );\n  if (!pkg.scripts) {\n    pkg.scripts = {};\n  }\n  pkg.scripts.start = 'react-native start';\n  pkg.scripts.ios = 'react-native run-ios';\n  pkg.scripts.android = 'react-native run-android';\n\n  /**\n   * Update package.json dependencies by combining the dependencies in the project we are ejecting\n   * with the dependencies in the template project. Does the same for devDependencies.\n   *\n   * - The template may have some dependencies beyond react/react-native/react-native-unimodules,\n   *   for example RNGH and Reanimated. We should prefer the version that is already being used\n   *   in the project for those, but swap the react/react-native/react-native-unimodules versions\n   *   with the ones in the template.\n   * - The same applies to expo-updates -- since some native project configuration may depend on the\n   *   version, we should always use the version of expo-updates in the template.\n   */\n\n  const combinedDependencies: DependenciesMap = createDependenciesMap({\n    ...defaultDependencies,\n    ...pkg.dependencies,\n  });\n\n  const requiredDependencies = ['react', 'react-native-unimodules', 'react-native', 'expo-updates'];\n\n  for (const dependenciesKey of requiredDependencies) {\n    combinedDependencies[dependenciesKey] = defaultDependencies[dependenciesKey];\n  }\n  const combinedDevDependencies: DependenciesMap = createDependenciesMap({\n    ...defaultDevDependencies,\n    ...pkg.devDependencies,\n  });\n\n  // Only change the dependencies if the normalized hash changes, this helps to reduce meaningless changes.\n  const hasNewDependencies =\n    hashForDependencyMap(pkg.dependencies) !== hashForDependencyMap(combinedDependencies);\n  const hasNewDevDependencies =\n    hashForDependencyMap(pkg.devDependencies) !== hashForDependencyMap(combinedDevDependencies);\n  // Save the dependencies\n  if (hasNewDependencies) {\n    pkg.dependencies = combinedDependencies;\n  }\n  if (hasNewDevDependencies) {\n    pkg.devDependencies = combinedDevDependencies;\n  }\n\n  /**\n   * Add new app entry points\n   */\n  let removedPkgMain;\n  // Check that the pkg.main doesn't match:\n  // - ./node_modules/expo/AppEntry\n  // - ./node_modules/expo/AppEntry.js\n  // - node_modules/expo/AppEntry.js\n  // - expo/AppEntry.js\n  // - expo/AppEntry\n  if (shouldDeleteMainField(pkg.main)) {\n    // Save the custom\n    removedPkgMain = pkg.main;\n    delete pkg.main;\n  }\n  await fs.writeFile(path.resolve(projectRoot, 'package.json'), JSON.stringify(pkg, null, 2));\n\n  updatingPackageJsonStep.succeed(\n    'Updated package.json and added index.js entry point for iOS and Android.'\n  );\n  if (removedPkgMain) {\n    log(\n      `- Removed ${chalk.bold(\n        `\"main\": \"${removedPkgMain}\"`\n      )} from package.json because we recommend using index.js as main instead.`\n    );\n    log.newLine();\n  }\n\n  return {\n    hasNewDependencies,\n    hasNewDevDependencies,\n  };\n}\n\nexport function resolveBareEntryFile(projectRoot: string, main: any) {\n  // expo app entry is not needed for bare projects.\n  if (isPkgMainExpoAppEntry(main)) return null;\n  // Look at the `package.json`s `main` field for the main file.\n  const resolvedMainField = main ?? './index';\n  // Get a list of possible extensions for the main file.\n  const extensions = getBareExtensions(['ios', 'android']);\n  // Testing the main field against all of the provided extensions - for legacy reasons we can't use node module resolution as the package.json allows you to pass in a file without a relative path and expect it as a relative path.\n  return getFileWithExtensions(projectRoot, resolvedMainField, extensions);\n}\n\nexport function shouldDeleteMainField(main?: any): boolean {\n  if (!main || !isPkgMainExpoAppEntry(main)) {\n    return false;\n  }\n\n  return !main?.startsWith('index.');\n}\n\nfunction normalizeDependencyMap(deps: DependenciesMap): string[] {\n  return Object.keys(deps)\n    .map(dependency => `${dependency}@${deps[dependency]}`)\n    .sort();\n}\n\nexport function hashForDependencyMap(deps: DependenciesMap): string {\n  const depsList = normalizeDependencyMap(deps);\n  const depsString = depsList.join('\\n');\n  return createFileHash(depsString);\n}\n\nexport function getTargetPaths(\n  projectRoot: string,\n  pkg: PackageJSONConfig,\n  platforms: ModPlatform[]\n) {\n  const targetPaths: string[] = [...platforms];\n\n  const bareEntryFile = resolveBareEntryFile(projectRoot, pkg.main);\n  // Only create index.js if we cannot resolve the existing entry point (after replacing the expo entry).\n  if (!bareEntryFile) {\n    targetPaths.push('index.js');\n  }\n\n  return targetPaths;\n}\n\n/**\n * Extract the template and copy the ios and android directories over to the project directory.\n *\n * @param force should create native projects even if they already exist.\n * @return `true` if any project files were created.\n */\nasync function cloneNativeDirectoriesAsync({\n  projectRoot,\n  tempDir,\n  exp,\n  pkg,\n  platforms,\n}: {\n  projectRoot: string;\n  tempDir: string;\n  exp: Pick<ExpoConfig, 'name' | 'sdkVersion'>;\n  pkg: PackageJSONConfig;\n  platforms: ModPlatform[];\n}): Promise<string[]> {\n  const templateSpec = await validateBareTemplateExistsAsync(exp.sdkVersion!);\n\n  // NOTE(brentvatne): Removing spaces between steps for now, add back when\n  // there is some additional context for steps\n  const creatingNativeProjectStep = CreateApp.logNewSection(\n    'Creating native project directories (./ios and ./android) and updating .gitignore'\n  );\n\n  const targetPaths = getTargetPaths(projectRoot, pkg, platforms);\n\n  let copiedPaths: string[] = [];\n  let skippedPaths: string[] = [];\n  try {\n    await Exp.extractTemplateAppAsync(templateSpec, tempDir, exp);\n    [copiedPaths, skippedPaths] = copyPathsFromTemplate(projectRoot, tempDir, targetPaths);\n    const results = GitIgnore.mergeGitIgnorePaths(\n      path.join(projectRoot, '.gitignore'),\n      path.join(tempDir, '.gitignore')\n    );\n\n    let message = `Created native project${platforms.length > 1 ? 's' : ''}`;\n\n    if (skippedPaths.length) {\n      message += log.chalk.dim(\n        ` | ${skippedPaths.map(path => log.chalk.bold(`/${path}`)).join(', ')} already created`\n      );\n    }\n    if (!results?.didMerge) {\n      message += log.chalk.dim(` | gitignore already synced`);\n    } else if (results.didMerge && results.didClear) {\n      message += log.chalk.dim(` | synced gitignore`);\n    }\n    creatingNativeProjectStep.succeed(message);\n  } catch (e) {\n    log.error(e.message);\n    creatingNativeProjectStep.fail(\n      'Failed to create the native project - see the output above for more information.'\n    );\n    log(\n      chalk.yellow(\n        'You may want to delete the `./ios` and/or `./android` directories before running eject again.'\n      )\n    );\n    throw new SilentError(e);\n  }\n\n  return copiedPaths;\n}\n\n/**\n *\n * @param projectRoot\n * @param tempDir\n *\n * @return `true` if the project is ejecting, and `false` if it's syncing.\n */\nasync function createNativeProjectsFromTemplateAsync({\n  projectRoot,\n  exp,\n  pkg,\n  tempDir,\n  platforms,\n}: {\n  projectRoot: string;\n  exp: ExpoConfig;\n  pkg: PackageJSONConfig;\n  tempDir: string;\n  platforms: ModPlatform[];\n}): Promise<\n  { hasNewProjectFiles: boolean; needsPodInstall: boolean } & DependenciesModificationResults\n> {\n  const copiedPaths = await cloneNativeDirectoriesAsync({\n    projectRoot,\n    tempDir,\n    exp,\n    pkg,\n    platforms,\n  });\n\n  writeMetroConfig({ projectRoot, pkg, tempDir });\n\n  const depsResults = await updatePackageJSONAsync({ projectRoot, tempDir, pkg });\n\n  return {\n    hasNewProjectFiles: !!copiedPaths.length,\n    // If the iOS folder changes or new packages are added, we should rerun pod install.\n    needsPodInstall:\n      copiedPaths.includes('ios') ||\n      depsResults.hasNewDependencies ||\n      depsResults.hasNewDevDependencies,\n    ...depsResults,\n  };\n}\n\n/**\n * Create an object of type DependenciesMap a dependencies object or throw if not valid.\n *\n * @param dependencies - ideally an object of type {[key]: string} - if not then this will error.\n */\nfunction createDependenciesMap(dependencies: any): DependenciesMap {\n  if (typeof dependencies !== 'object') {\n    throw new Error(`Dependency map is invalid, expected object but got ${typeof dependencies}`);\n  }\n\n  const outputMap: DependenciesMap = {};\n  if (!dependencies) return outputMap;\n\n  for (const key of Object.keys(dependencies)) {\n    const value = dependencies[key];\n    if (typeof value === 'string') {\n      outputMap[key] = value;\n    } else {\n      throw new Error(\n        `Dependency for key \\`${key}\\` should be a \\`string\\`, instead got: \\`{ ${key}: ${JSON.stringify(\n          value\n        )} }\\``\n      );\n    }\n  }\n  return outputMap;\n}\n\n/**\n * Some packages are not configured automatically on eject and may require\n * users to add some code, eg: to their AppDelegate.\n */\nasync function warnIfDependenciesRequireAdditionalSetupAsync(\n  pkg: PackageJSONConfig,\n  sdkVersion?: string\n): Promise<void> {\n  const expoPackagesWithExtraSetup = [\n    'expo-camera',\n    'expo-image-picker',\n    'expo-av',\n    'expo-background-fetch',\n    'expo-barcode-scanner',\n    'expo-brightness',\n    'expo-calendar',\n    'expo-contacts',\n    'expo-file-system',\n    'expo-location',\n    'expo-media-library',\n    'expo-notifications',\n    'expo-screen-orientation',\n    'expo-sensors',\n    'expo-task-manager',\n  ].reduce(\n    (prev, curr) => ({\n      ...prev,\n      [curr]: `https://github.com/expo/expo/tree/master/packages/${curr}`,\n    }),\n    {}\n  );\n  const pkgsWithExtraSetup: Record<string, string> = {\n    ...expoPackagesWithExtraSetup,\n    'lottie-react-native': 'https://github.com/react-native-community/lottie-react-native',\n  };\n\n  // Starting with SDK 40 the manifest is embedded in ejected apps automatically\n  if (sdkVersion && semver.lte(sdkVersion, '39.0.0')) {\n    pkgsWithExtraSetup['expo-constants'] = `${chalk.bold(\n      'Constants.manifest'\n    )} is not available in the bare workflow. You should replace it with ${chalk.bold(\n      'Updates.manifest'\n    )}. ${log.chalk.dim(\n      learnMore('https://docs.expo.io/versions/latest/sdk/updates/#updatesmanifest')\n    )}`;\n  }\n\n  const packagesToWarn: string[] = Object.keys(pkg.dependencies).filter(\n    pkgName => pkgName in pkgsWithExtraSetup\n  );\n\n  if (packagesToWarn.length === 0) {\n    return;\n  }\n\n  log.newLine();\n  const warnAdditionalSetupStep = CreateApp.logNewSection(\n    'Checking if any additional setup steps are required for installed SDK packages.'\n  );\n\n  const plural = packagesToWarn.length > 1;\n\n  warnAdditionalSetupStep.stopAndPersist({\n    symbol: '⚠️ ',\n    text: chalk.red(\n      `Your app includes ${chalk.bold(`${packagesToWarn.length}`)} package${\n        plural ? 's' : ''\n      } that require${plural ? '' : 's'} additional setup in order to run:`\n    ),\n  });\n\n  packagesToWarn.forEach(pkgName => {\n    log.nested(`- ${chalk.bold(pkgName)}: ${pkgsWithExtraSetup[pkgName]}`);\n  });\n}\n\nexport function stripDashes(s: string): string {\n  return s.replace(/\\s|-/g, '');\n}\n\n/**\n * Returns true if the input string matches the default expo main field.\n *\n * - ./node_modules/expo/AppEntry\n * - ./node_modules/expo/AppEntry.js\n * - node_modules/expo/AppEntry.js\n * - expo/AppEntry.js\n * - expo/AppEntry\n *\n * @param input package.json main field\n */\nexport function isPkgMainExpoAppEntry(input?: string): boolean {\n  const main = input || '';\n  if (main.startsWith('./')) {\n    return main.includes('node_modules/expo/AppEntry');\n  }\n  return main.includes('expo/AppEntry');\n}\n"],"file":"Eject.js"}