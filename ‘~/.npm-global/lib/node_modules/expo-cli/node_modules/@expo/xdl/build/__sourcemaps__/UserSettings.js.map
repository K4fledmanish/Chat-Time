{"version":3,"sources":["UserSettings.ts"],"names":["SETTINGS_FILE_NAME","userSettingsFile","dir","dotExpoHomeDirectory","file","path","join","oldFile","fs","statSync","isFile","renameSync","e","userSettingsJsonFile","JsonFile","jsonParseErrorDefault","cantReadFileDefault","mkdirped","dirPath","process","env","__UNSAFE_EXPO_HOME_DIRECTORY","home","Env","Error","EXPO_STAGING","EXPO_LOCAL","oldDirPath","isDirectory","mkdirpSync","anonymousIdentifier","settings","id","getAsync","uuid","v4","setAsync","accessToken","EXPO_TOKEN","UserSettings","Object","assign"],"mappings":"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","sourcesContent":["import JsonFile from '@expo/json-file';\nimport fs from 'fs-extra';\nimport path from 'path';\nimport uuid from 'uuid';\n\nimport * as Env from './Env';\nimport { ConnectionType } from './User';\n\nexport type UserSettingsData = {\n  appleId?: string;\n  accessToken?: string;\n  auth?: UserData | null;\n  ignoreBundledBinaries?: string[];\n  openDevToolsAtStartup?: boolean;\n  PATH?: string;\n  sendTo?: string;\n  uuid?: string;\n};\n\nexport type UserData = {\n  appleId?: string;\n  userId?: string;\n  username?: string;\n  currentConnection?: ConnectionType;\n  sessionSecret?: string;\n};\n\nconst SETTINGS_FILE_NAME = 'state.json';\n\nfunction userSettingsFile(): string {\n  const dir = dotExpoHomeDirectory();\n  const file = path.join(dir, SETTINGS_FILE_NAME);\n  try {\n    // move exponent.json to state.json\n    const oldFile = path.join(dir, 'exponent.json');\n    if (fs.statSync(oldFile).isFile()) {\n      fs.renameSync(oldFile, file);\n    }\n  } catch (e) {\n    // no old directory, continue\n  }\n  return file;\n}\n\nfunction userSettingsJsonFile(): JsonFile<UserSettingsData> {\n  return new JsonFile<UserSettingsData>(userSettingsFile(), {\n    jsonParseErrorDefault: {},\n    cantReadFileDefault: {},\n  });\n}\n\nvar mkdirped = false;\nfunction dotExpoHomeDirectory() {\n  let dirPath;\n  if (process.env.__UNSAFE_EXPO_HOME_DIRECTORY) {\n    dirPath = process.env.__UNSAFE_EXPO_HOME_DIRECTORY;\n  } else {\n    const home = Env.home();\n    if (!home) {\n      throw new Error(\n        \"Can't determine your home directory; make sure your $HOME environment variable is set.\"\n      );\n    }\n\n    if (process.env.EXPO_STAGING) {\n      dirPath = path.join(home, '.expo-staging');\n    } else if (process.env.EXPO_LOCAL) {\n      dirPath = path.join(home, '.expo-local');\n    } else {\n      dirPath = path.join(home, '.expo');\n    }\n\n    try {\n      // move .exponent to .expo\n      const oldDirPath = path.join(home, '.exponent');\n      if (fs.statSync(oldDirPath).isDirectory()) {\n        fs.renameSync(oldDirPath, dirPath);\n      }\n    } catch (e) {\n      // no old directory, continue\n    }\n  }\n  if (!mkdirped) {\n    fs.mkdirpSync(dirPath);\n    mkdirped = true;\n  }\n  return dirPath;\n}\n\n// returns an anonymous, unique identifier for a user on the current computer\nasync function anonymousIdentifier(): Promise<string> {\n  const settings = await userSettingsJsonFile();\n  let id = await settings.getAsync('uuid', null);\n\n  if (!id) {\n    id = uuid.v4();\n    await settings.setAsync('uuid', id);\n  }\n\n  return id;\n}\n\nfunction accessToken(): string | null {\n  return process.env.EXPO_TOKEN || null;\n}\n\nconst UserSettings = Object.assign(userSettingsJsonFile(), {\n  dotExpoHomeDirectory,\n  userSettingsFile,\n  userSettingsJsonFile,\n  accessToken,\n  anonymousIdentifier,\n  SETTINGS_FILE_NAME,\n});\n\nexport default UserSettings;\n"],"file":"../UserSettings.js","sourceRoot":"/@expo/xdl@59.0.13/src"}