{"version":3,"sources":["webpack-utils/createWebpackCompiler.ts"],"names":["CONSOLE_TAG","SHOULD_CLEAR_CONSOLE","log","projectRoot","message","showInDevtools","ProjectUtils","logInfo","console","clearLogs","process","stdout","write","platform","logWarning","logError","printInstructions","appName","urls","printPreviewNotice","chalk","bold","divider","dim","lanUrlForTerminal","reset","localUrlForTerminal","magenta","dimBorder","borderColor","padding","top","left","bottom","right","createWebpackCompiler","config","nonInteractive","webpackFactory","onFinished","compiler","hooks","invalid","tap","isFirstCompile","done","stats","statsData","toJson","all","warnings","errors","messages","isSuccessful","length","red","join","yellow","printSuccessMessages","cyan"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) 2015-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\nimport boxen from 'boxen';\nimport chalk from 'chalk';\nimport { Urls } from 'react-dev-utils/WebpackDevServerUtils';\nimport formatWebpackMessages from 'react-dev-utils/formatWebpackMessages';\nimport webpack from 'webpack';\n\nimport * as ProjectUtils from '../project/ProjectUtils';\nimport { logEnvironmentInfo, shouldWebpackClearLogs } from './WebpackEnvironment';\n\nconst CONSOLE_TAG = 'expo';\n\nconst SHOULD_CLEAR_CONSOLE = shouldWebpackClearLogs();\n\nfunction log(projectRoot: string, message: string, showInDevtools = true) {\n  if (showInDevtools) {\n    ProjectUtils.logInfo(projectRoot, CONSOLE_TAG, message);\n  } else {\n    console.log(message);\n  }\n}\n\nfunction clearLogs() {\n  process.stdout.write(process.platform === 'win32' ? '\\x1B[2J\\x1B[0f' : '\\x1B[2J\\x1B[3J\\x1B[H');\n}\n\nfunction logWarning(projectRoot: string, message: string) {\n  ProjectUtils.logWarning(projectRoot, CONSOLE_TAG, message);\n}\n\nfunction logError(projectRoot: string, message: string) {\n  ProjectUtils.logError(projectRoot, CONSOLE_TAG, message);\n}\n\nexport function printInstructions(\n  projectRoot: string,\n  {\n    appName,\n    urls,\n    showInDevtools,\n  }: {\n    appName: string;\n    urls: Urls;\n    showInDevtools: boolean;\n  }\n) {\n  printPreviewNotice(projectRoot, showInDevtools);\n\n  let message = '\\n';\n  message += `You can now view ${chalk.bold(appName)} in the browser\\n`;\n\n  const divider = chalk.dim`â”‚`;\n\n  if (urls.lanUrlForTerminal) {\n    message += `\\n \\u203A ${chalk.reset('Local')}   ${divider} ${urls.localUrlForTerminal}`;\n    message += `\\n \\u203A ${chalk.reset('LAN')}     ${divider} ${urls.lanUrlForTerminal}`;\n  } else {\n    message += `\\n \\u203A ${urls.localUrlForTerminal}`;\n  }\n\n  message += '\\n';\n\n  message += `\\n \\u203A Run ${chalk.bold(`expo build:web`)} to optimize and build for production`;\n\n  message += '\\n';\n\n  message += `\\n \\u203A Press ${chalk.bold(`w`)} ${divider} open in the browser`;\n  message += `\\n \\u203A Press ${chalk.bold(`?`)} ${divider} show all commands`;\n\n  log(projectRoot, message, showInDevtools);\n}\n\nexport function printPreviewNotice(projectRoot: string, showInDevtools: boolean) {\n  log(\n    projectRoot,\n    boxen(\n      chalk.magenta.dim(\n        'Expo web is in late beta, please report any bugs or missing features on the Expo repo.\\n' +\n          'You can follow the V1 release for more info: https://github.com/expo/expo/issues/6782'\n      ),\n      { dimBorder: true, borderColor: 'magenta', padding: { top: 0, left: 1, bottom: 0, right: 1 } }\n    ),\n    showInDevtools\n  );\n}\n\nexport default function createWebpackCompiler({\n  projectRoot,\n  appName,\n  config,\n  urls,\n  nonInteractive,\n  webpackFactory,\n  onFinished,\n}: {\n  projectRoot: string;\n  appName: string;\n  config: webpack.Configuration;\n  urls: Urls;\n  nonInteractive?: boolean;\n  webpackFactory: (options?: webpack.Configuration) => webpack.Compiler;\n  onFinished: () => void;\n}) {\n  // \"Compiler\" is a low-level interface to Webpack.\n  // It lets us listen to some events and provide our own custom messages.\n  const compiler = webpackFactory(config);\n\n  // \"invalid\" event fires when you have changed a file, and Webpack is\n  // recompiling a bundle. WebpackDevServer takes care to pause serving the\n  // bundle, so if you refresh, it'll wait instead of serving the old one.\n  // \"invalid\" is short for \"bundle invalidated\", it doesn't imply any errors.\n  compiler.hooks.invalid.tap('invalid', () => {\n    log(projectRoot, '\\nCompiling...');\n  });\n\n  let isFirstCompile = true;\n\n  // \"done\" event fires when Webpack has finished recompiling the bundle.\n  // Whether or not you have warnings or errors, you will get this event.\n  compiler.hooks.done.tap('done', async stats => {\n    if (SHOULD_CLEAR_CONSOLE && !nonInteractive) {\n      clearLogs();\n    }\n\n    // We have switched off the default Webpack output in WebpackDevServer\n    // options so we are going to \"massage\" the warnings and errors and present\n    // them in a readable focused way.\n    // We only construct the warnings and errors for speed:\n    // https://github.com/facebook/create-react-app/issues/4492#issuecomment-421959548\n    const statsData = stats.toJson({\n      all: false,\n      warnings: true,\n      errors: true,\n    });\n\n    const messages = formatWebpackMessages(statsData);\n\n    const isSuccessful = !messages.errors.length && !messages.warnings.length;\n\n    if (isSuccessful) {\n      logEnvironmentInfo(projectRoot, CONSOLE_TAG, config);\n    }\n\n    if (isSuccessful && !isFirstCompile && !nonInteractive) {\n      printInstructions(projectRoot, {\n        appName,\n        urls,\n        showInDevtools: isFirstCompile,\n      });\n    }\n\n    onFinished();\n    isFirstCompile = false;\n\n    // If errors exist, only show errors.\n    if (messages.errors.length) {\n      // Only keep the first error. Others are often indicative\n      // of the same problem, but confuse the reader with noise.\n      if (messages.errors.length > 1) {\n        messages.errors.length = 1;\n      }\n      logError(projectRoot, chalk.red('Failed to compile.\\n') + messages.errors.join('\\n\\n'));\n      return;\n    }\n\n    // Show warnings if no errors were found.\n    if (messages.warnings.length) {\n      logWarning(\n        projectRoot,\n        chalk.yellow('Compiled with warnings.\\n') + messages.warnings.join('\\n\\n')\n      );\n    }\n  });\n\n  return compiler;\n}\n\nexport function printSuccessMessages({\n  projectRoot,\n  appName,\n  urls,\n  config,\n  isFirstCompile,\n  nonInteractive,\n}: {\n  projectRoot: string;\n  appName: string;\n  config: webpack.Configuration;\n  urls: Urls;\n  isFirstCompile: boolean;\n  nonInteractive?: boolean;\n}) {\n  log(projectRoot, chalk.bold.cyan(`Compiled successfully!`));\n  printPreviewNotice(projectRoot, isFirstCompile);\n  logEnvironmentInfo(projectRoot, CONSOLE_TAG, config);\n\n  if (!nonInteractive || isFirstCompile) {\n    printInstructions(projectRoot, {\n      appName,\n      urls,\n      showInDevtools: isFirstCompile,\n    });\n  }\n}\n"],"file":"../../webpack-utils/createWebpackCompiler.js","sourceRoot":"/@expo/xdl@59.0.13/src"}